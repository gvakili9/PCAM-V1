<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Dâstân-e Mâ: Persian Cultural Alignment Model</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@400;700&family=Inter:wght@400;600&display=swap" rel="stylesheet">

  <style>
    body {
      font-family: 'Inter', sans-serif;
      background-color: #f7f3f2;
    }

    .persian-font {
      font-family: 'Vazirmatn', sans-serif;
      direction: rtl;
      line-height: 2;
    }

    .card {
      background: white;
      box-shadow: 0 10px 30px rgba(0,0,0,.1);
    }

    .btn-primary {
      background-color: #0f766e;
    }

    .btn-primary:hover {
      background-color: #115e59;
    }

    .border-iran {
      border-color: #c9a227;
    }
  </style>
</head>

<body class="p-6 min-h-screen">

<div id="app" class="max-w-5xl mx-auto">

  <!-- HEADER -->
  <header class="text-center mb-10 flex flex-col items-center">

    <!-- Persian Calligraphy Logo -->
    <img
      src="/images/dastan-ma.png"
      alt="Dâstân-e Mâ Persian Calligraphy"
      class="h-16 mb-4"
    />

    <h1 class="text-4xl font-extrabold text-gray-800 mb-2">
      Dâstân-e Mâ: Our Story Model
    </h1>

    <p class="text-xl text-gray-500">
      Deployed via Vercel (<span class="persian-font">سنت ← آینده</span>)
    </p>
  </header>

  <!-- HERO IMAGE -->
  <div class="mb-10 rounded-xl overflow-hidden shadow-xl border border-iran">
    <img
      src="/images/rostam-esfandiar.webp"
      alt="Shahnameh miniature – Rostam and Esfandiar"
      class="w-full h-[260px] object-cover"
    />
  </div>

  <!-- MAIN GRID -->
  <div class="lg:flex lg:gap-6">

    <!-- CONTROLS -->
    <div class="lg:w-1/3 p-6 card rounded-xl border-t-4 border-iran mb-6 lg:mb-0">
      <h2 class="text-2xl font-semibold mb-4">Story Parameters</h2>

      <div class="space-y-4">

        <div>
          <label class="block text-sm mb-1">Cultural Theme</label>
          <select id="theme" class="w-full p-3 border rounded-lg">
            <option>Nowruz / Haft-Seen</option>
            <option>Yalda / Shahnameh</option>
            <option>Persian Garden Fables</option>
            <option>Sizdah Bedar</option>
            <option>Chaharshanbe Suri</option>
          </select>
        </div>

        <div>
          <label class="block text-sm mb-1">Core Value</label>
          <select id="value" class="w-full p-3 border rounded-lg">
            <option value="respect_family">Respect & Family Unity</option>
            <option value="kindness_generosity">Kindness & Hospitality</option>
            <option value="bravery_humility">Bravery & Humility</option>
          </select>
        </div>

        <div>
          <label class="block text-sm mb-1">Story Topic</label>
          <textarea
            id="customPrompt"
            rows="3"
            class="w-full p-3 border rounded-lg"
            placeholder="A child helping set the Haft-Seen table"
          ></textarea>
        </div>

        <button id="generateBtn"
          class="w-full btn-primary text-white font-bold py-3 rounded-xl">
          Generate Bilingual Story
        </button>

      </div>
    </div>

    <!-- OUTPUT -->
    <div class="lg:w-2/3 p-6 card rounded-xl">
      <h2 class="text-2xl font-semibold mb-4">
        Generated Story
      </h2>

      <div id="storyOutput"
           class="min-h-[380px] border rounded-lg p-4 bg-gray-50">
        <p class="text-center text-gray-400 mt-32">
          Select parameters and click “Generate”
        </p>
      </div>

      <div id="footnoteContainer"
           class="mt-4 p-3 bg-yellow-100 border-l-4 border-yellow-600 hidden">
        <strong>Parent Footnote:</strong>
        <p id="footnoteText"></p>
      </div>

      <div id="errorBox"
           class="mt-4 p-3 bg-red-100 border-l-4 border-red-600 hidden">
        <strong>Error:</strong>
        <p id="errorText"></p>
      </div>

    </div>
  </div>

  <!-- FOOTER -->
  <footer class="text-center text-sm text-gray-500 mt-12">
    Inspired by Persian oral storytelling traditions • شاهنامه • فولکلور ایرانی
  </footer>

</div>

<!-- SCRIPT (unchanged logic) -->
<script>
const VALUE_MAP = {
  respect_family: "Focus on honoring elders and family unity.",
  kindness_generosity: "Focus on hospitality and generosity.",
  bravery_humility: "Focus on courage without arrogance."
};

const btn = document.getElementById('generateBtn');
const output = document.getElementById('storyOutput');
const footnote = document.getElementById('footnoteContainer');
const footnoteText = document.getElementById('footnoteText');
const errorBox = document.getElementById('errorBox');
const errorText = document.getElementById('errorText');

btn.onclick = async () => {
  const payload = {
    theme: theme.value,
    valueInstruction: VALUE_MAP[value.value],
    userTopic: customPrompt.value
  };

  try {
    const res = await fetch('/api/generate', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(payload)
    });

    const data = await res.json();

    let html = `<h3 class="text-xl font-bold mb-4">${data.title_en} / ${data.title_fa}</h3>`;
    data.story_pairs.forEach(p => {
      html += `
        <p class="mb-3">${p.en}</p>
        <p class="persian-font mb-6">${p.fa}</p>
      `;
    });

    output.innerHTML = html;
    footnoteText.innerHTML = data.cultural_footnote;
    footnote.classList.remove('hidden');
    errorBox.classList.add('hidden');

  } catch (e) {
    errorText.textContent = e.message;
    errorBox.classList.remove('hidden');
    footnote.classList.add('hidden');
  }
};
</script>

</body>
</html>
